using FluentValidation;
using QuestionarioOnline.Application.DTOs.Requests;

namespace QuestionarioOnline.Application.Validators;

public class RegistrarRespostaRequestValidator : AbstractValidator<RegistrarRespostaRequest>
{
    public RegistrarRespostaRequestValidator()
    {
        RuleFor(x => x.QuestionarioId)
            .NotEmpty().WithMessage("QuestionarioId é obrigatório");

        RuleFor(x => x.Respostas)
            .NotEmpty().WithMessage("Respostas é obrigatório")
            .Must(respostas => respostas != null && respostas.Any())
            .WithMessage("Deve haver pelo menos uma resposta");

        RuleForEach(x => x.Respostas).ChildRules(resposta =>
        {
            resposta.RuleFor(r => r.PerguntaId)
                .NotEmpty().WithMessage("PerguntaId é obrigatório");

            resposta.RuleFor(r => r.OpcaoRespostaId)
                .NotEmpty().WithMessage("OpcaoRespostaId é obrigatório");
        });

        RuleFor(x => x.Estado)
            .MaximumLength(100).WithMessage("Estado deve ter no máximo 100 caracteres")
            .When(x => !string.IsNullOrEmpty(x.Estado));

        RuleFor(x => x.Cidade)
            .MaximumLength(200).WithMessage("Cidade deve ter no máximo 200 caracteres")
            .When(x => !string.IsNullOrEmpty(x.Cidade));

        RuleFor(x => x.RegiaoGeografica)
            .MaximumLength(100).WithMessage("RegiaoGeografica deve ter no máximo 100 caracteres")
            .When(x => !string.IsNullOrEmpty(x.RegiaoGeografica));
    }
}
