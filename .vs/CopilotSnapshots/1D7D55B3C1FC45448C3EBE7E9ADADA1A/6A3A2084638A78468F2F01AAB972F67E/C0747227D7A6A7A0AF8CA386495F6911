using FluentValidation;
using QuestionarioOnline.Application.DTOs;

namespace QuestionarioOnline.Application.Validators;

/// <summary>
/// Validador para criação de questionário
/// </summary>
public class CriarQuestionarioRequestValidator : AbstractValidator<CriarQuestionarioRequest>
{
    public CriarQuestionarioRequestValidator()
    {
        RuleFor(x => x.Titulo)
            .NotEmpty().WithMessage("Título é obrigatório")
            .MaximumLength(200).WithMessage("Título deve ter no máximo 200 caracteres");

        RuleFor(x => x.Descricao)
            .MaximumLength(1000).WithMessage("Descrição deve ter no máximo 1000 caracteres")
            .When(x => !string.IsNullOrEmpty(x.Descricao));

        RuleFor(x => x.DataInicio)
            .NotEmpty().WithMessage("Data de início é obrigatória")
            .LessThan(x => x.DataFim).WithMessage("Data de início deve ser anterior à data de fim");

        RuleFor(x => x.DataFim)
            .NotEmpty().WithMessage("Data de fim é obrigatória")
            .GreaterThan(DateTime.UtcNow).WithMessage("Data de fim deve ser futura");

        RuleFor(x => x.Perguntas)
            .NotEmpty().WithMessage("Questionário deve ter pelo menos uma pergunta")
            .Must(perguntas => perguntas.Count >= 1).WithMessage("Questionário deve ter pelo menos uma pergunta");

        RuleForEach(x => x.Perguntas).SetValidator(new PerguntaDtoValidator());
    }
}

/// <summary>
/// Validador para pergunta
/// </summary>
public class PerguntaDtoValidator : AbstractValidator<PerguntaDto>
{
    public PerguntaDtoValidator()
    {
        RuleFor(x => x.Texto)
            .NotEmpty().WithMessage("Texto da pergunta é obrigatório")
            .MaximumLength(500).WithMessage("Texto da pergunta deve ter no máximo 500 caracteres");

        RuleFor(x => x.OpcoesDe
Resposta)
            .NotEmpty().WithMessage("Pergunta deve ter pelo menos uma opção de resposta")
            .Must(opcoes => opcoes.Count >= 2).WithMessage("Pergunta deve ter pelo menos duas opções de resposta");

        RuleForEach(x => x.OpcoesDeResposta).SetValidator(new OpcaoRespostaValidator());
    }
}

/// <summary>
/// Validador para opção de resposta
/// </summary>
public class OpcaoRespostaValidator : AbstractValidator<OpcaoRespostaDto>
{
    public OpcaoRespostaValidator()
    {
        RuleFor(x => x.Texto)
            .NotEmpty().WithMessage("Texto da opção é obrigatório")
            .MaximumLength(500).WithMessage("Texto da opção deve ter no máximo 500 caracteres");

        RuleFor(x => x.Ordem)
            .GreaterThanOrEqualTo(0).WithMessage("Ordem deve ser maior ou igual a zero");
    }
}
